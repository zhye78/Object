# Chapter 3 - 역할, 책임, 협력

2장(객체지향 프로그래밍)에서 상속이나 지연 바인딩과 같은 '구현'을 중점으로 설명했다면, 이번 장에서는 기능 구현을 위해 필요한 역할, 책임, 협력에 대해 설명한다.

# 협력

> 객체들이 애플리케이션의 기능을 구현하기 위해 수행하는 상호작용

- 객체 사이의 협력은 하나의 객체가 다른 객체에게 **메시지 전송**을 통해 무엇인가 요청할 때 시작되며, 해당 메시지를 수신한 객체는 **메서드**를 실행하여 요청에 응답한다.

![Chapter%203%20-%20%E1%84%8B%E1%85%A7%E1%86%A8%E1%84%92%E1%85%A1%E1%86%AF,%20%E1%84%8E%E1%85%A2%E1%86%A8%E1%84%8B%E1%85%B5%E1%86%B7,%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%205aafc9eb9cef4f6cad263c6f71870891/%EC%BA%A1%EC%B2%98.jpg](Chapter%203%20-%20%E1%84%8B%E1%85%A7%E1%86%A8%E1%84%92%E1%85%A1%E1%86%AF,%20%E1%84%8E%E1%85%A2%E1%86%A8%E1%84%8B%E1%85%B5%E1%86%B7,%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%205aafc9eb9cef4f6cad263c6f71870891/%EC%BA%A1%EC%B2%98.jpg)

p.75 그림 3.2

 그림을 보면 Screening 은 Movie에 calculateMovieFee 메시지를 전송함으로써 예매자 한 명의 요금 계산을 요청한다.

 */**여기서 Screening이 Movie에게 처리를 위임하는 이유는 Movie가 알고있는 정보를 직접 사용하여 자율적인 객체가 되도록 하기 위함이다. Screening이 직접 수행한다면 Movie의 인스턴스 변수에 접근하게 되고, Movie의 자율성은 훼손된다.*/

 이렇게 객체가 할당된 작업을 수행하던 중 필요한 정보를 알지 못하거나 외부의 도움이 필요한 경우 적절한 객체에게 메시지를 전송하여 협력을 요청한다.

 

- 객체의 행동을 결정하는 것은 객체가 참여하고 있는 **협력**이다. 협력이 바뀌면 객체가 제공하는 행동도 바뀌게 된다.

```java
puglic class Movie{
	private Money Fee;
	private DiscountPolicy discountPolicy;

	public Money calculateMovieFee(Screening screening){
		return fee.minus(discountPolicy.calculateDiscountAmount(screening));
	}
}
```

 Movie 객체는 단어만 들으면 Play라는 행동을 수행할 것 같다는 느낌이 들지만, 코드를 보면 요금을 계산하는 행동과 관련된 것들이 대부분이다.

 이는 Movie가 영화를 예매하기 위한 협력에 참여하고 있고, 그 안에서 요금 계산이라는 책임을 지고 있기 때문이다.

- 객체의 상태를 결정하는 것은 행동이다. 객체의 상태는 그 객체가 행동을 수행하는 데 필요한 정보가 무엇인지로 결정된다.

 Movie가 discountPolicy라는 인스턴스 변수를 상태의 일부로 포함하는 이유는 요금 계산이라는 행동을 수행하는 데 이 정보들이 필요하기 때문이다.

✔결과적으로 객체가 참여하는 협력이 객체를 구성하는 행동과 상태 모두를 결정하기 때문에, 협력은 객체를 설계하는 데 필요한 일종의 **문맥을 제공**한다.

# 책임

> 객체가 협력에 참여하기위해 수행하는 행동, 객체지향 설계에서 가장 중요한 것은 책임

- 책임은 크게 '하는 것(doing)'과 '아는 것(knowing)'으로 나눌 수 있다.

![Chapter%203%20-%20%E1%84%8B%E1%85%A7%E1%86%A8%E1%84%92%E1%85%A1%E1%86%AF,%20%E1%84%8E%E1%85%A2%E1%86%A8%E1%84%8B%E1%85%B5%E1%86%B7,%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%205aafc9eb9cef4f6cad263c6f71870891/Untitled.png](Chapter%203%20-%20%E1%84%8B%E1%85%A7%E1%86%A8%E1%84%92%E1%85%A1%E1%86%AF,%20%E1%84%8E%E1%85%A2%E1%86%A8%E1%84%8B%E1%85%B5%E1%86%B7,%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%205aafc9eb9cef4f6cad263c6f71870891/Untitled.png)

 (p.79 그림 3.3 참고) 영화 예매 시스템에서 Screening의 책임은 영화를 예매하는 것이다. 이 때, '예매 정보를 생성한다'는 하는 것과 관련된 책임이고, '상영할 영화를 알고 있어야 한다'는 아는 것과 관련된 책임이다. 다른 객체들도 대부분 하는 것과 아는 것을 동시에 가지고 있다.

 어떤 책임을 수행하기 위해서는 그 책임을 수행하는 데 필요한 정보도 함께 알아야 할 책임이 있으므로 '하는 것'과 '아는 것'은 밀접하게 연관되어 있다. 

- 책임을 수행하는 데 필요한 정보를 가장 잘 알고 있는 객체에게 그 책임을 할당하는 **Information Expert(정보 전문가)** 패턴

 객체에게 책임을 할당하기 위해서는 먼저 협력이라는 문맥을 정의해야 한다. 영화 예매 시스템을 예로 든다.

1. 객체가 책임을 수행하게 하는 유일한 방법은 메시지를 전송하는 것이므로, 책임 할당과 같은 의미인 메시지 이름 결정

    ![Chapter%203%20-%20%E1%84%8B%E1%85%A7%E1%86%A8%E1%84%92%E1%85%A1%E1%86%AF,%20%E1%84%8E%E1%85%A2%E1%86%A8%E1%84%8B%E1%85%B5%E1%86%B7,%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%205aafc9eb9cef4f6cad263c6f71870891/Untitled%201.png](Chapter%203%20-%20%E1%84%8B%E1%85%A7%E1%86%A8%E1%84%92%E1%85%A1%E1%86%AF,%20%E1%84%8E%E1%85%A2%E1%86%A8%E1%84%8B%E1%85%B5%E1%86%B7,%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%205aafc9eb9cef4f6cad263c6f71870891/Untitled%201.png)

2. 관련된 정보를 가장 많이 알고 있는 정보 전문가 객체 선택, 메시지 할당

    ![Chapter%203%20-%20%E1%84%8B%E1%85%A7%E1%86%A8%E1%84%92%E1%85%A1%E1%86%AF,%20%E1%84%8E%E1%85%A2%E1%86%A8%E1%84%8B%E1%85%B5%E1%86%B7,%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%205aafc9eb9cef4f6cad263c6f71870891/Untitled%202.png](Chapter%203%20-%20%E1%84%8B%E1%85%A7%E1%86%A8%E1%84%92%E1%85%A1%E1%86%AF,%20%E1%84%8E%E1%85%A2%E1%86%A8%E1%84%8B%E1%85%B5%E1%86%B7,%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%205aafc9eb9cef4f6cad263c6f71870891/Untitled%202.png)

3. 외부 도움이 필요하다면, 새로운 메시지 생성

    ![Chapter%203%20-%20%E1%84%8B%E1%85%A7%E1%86%A8%E1%84%92%E1%85%A1%E1%86%AF,%20%E1%84%8E%E1%85%A2%E1%86%A8%E1%84%8B%E1%85%B5%E1%86%B7,%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%205aafc9eb9cef4f6cad263c6f71870891/Untitled%203.png](Chapter%203%20-%20%E1%84%8B%E1%85%A7%E1%86%A8%E1%84%92%E1%85%A1%E1%86%AF,%20%E1%84%8E%E1%85%A2%E1%86%A8%E1%84%8B%E1%85%B5%E1%86%B7,%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%205aafc9eb9cef4f6cad263c6f71870891/Untitled%203.png)

4. 새로운 메시지와 관련한 정보 전문가 객체 선택

    ![Chapter%203%20-%20%E1%84%8B%E1%85%A7%E1%86%A8%E1%84%92%E1%85%A1%E1%86%AF,%20%E1%84%8E%E1%85%A2%E1%86%A8%E1%84%8B%E1%85%B5%E1%86%B7,%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%205aafc9eb9cef4f6cad263c6f71870891/Untitled%204.png](Chapter%203%20-%20%E1%84%8B%E1%85%A7%E1%86%A8%E1%84%92%E1%85%A1%E1%86%AF,%20%E1%84%8E%E1%85%A2%E1%86%A8%E1%84%8B%E1%85%B5%E1%86%B7,%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%205aafc9eb9cef4f6cad263c6f71870891/Untitled%204.png)

 이처럼 객체지향 설계는 협력에 필요한 메시지를 찾고 메시지에 적절한 객체를 선택하는 반복적인 과정을 통해 이루어지며, 이런 메시지가 메시지를 수신할 객체의 책임을 결정한다.

 → 책임을 찾고, 수행할 객체를 지정하여 책임을 할당하는 방식으로 협력을 설계하는 방법을 **책임 주도 설계**라고 부른다.

✔객체가 메시지를 결정하는 것이 아닌 메시지가 객체를 결정하고, 행동이 상태를 결정한다.

# 역할

> 객체가 특정한 협력 안에서 수행하는 책임의 집합

 이전에 예로 들었던 영화 예매 협력에서 '예매해라' 메시지의 책임 할당 과정은, 영화를 예매할 수 있는 적절한 역할이 무엇인지 찾는 것과, 역할을 수행할 객체로 Screening을 선택한 것 두 가지의 단계가 합쳐진 것이다.

![Chapter%203%20-%20%E1%84%8B%E1%85%A7%E1%86%A8%E1%84%92%E1%85%A1%E1%86%AF,%20%E1%84%8E%E1%85%A2%E1%86%A8%E1%84%8B%E1%85%B5%E1%86%B7,%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%205aafc9eb9cef4f6cad263c6f71870891/Untitled%205.png](Chapter%203%20-%20%E1%84%8B%E1%85%A7%E1%86%A8%E1%84%92%E1%85%A1%E1%86%AF,%20%E1%84%8E%E1%85%A2%E1%86%A8%E1%84%8B%E1%85%B5%E1%86%B7,%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%205aafc9eb9cef4f6cad263c6f71870891/Untitled%205.png)

![Chapter%203%20-%20%E1%84%8B%E1%85%A7%E1%86%A8%E1%84%92%E1%85%A1%E1%86%AF,%20%E1%84%8E%E1%85%A2%E1%86%A8%E1%84%8B%E1%85%B5%E1%86%B7,%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%205aafc9eb9cef4f6cad263c6f71870891/Untitled%206.png](Chapter%203%20-%20%E1%84%8B%E1%85%A7%E1%86%A8%E1%84%92%E1%85%A1%E1%86%AF,%20%E1%84%8E%E1%85%A2%E1%86%A8%E1%84%8B%E1%85%B5%E1%86%B7,%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%205aafc9eb9cef4f6cad263c6f71870891/Untitled%206.png)

- 역할이라는 개념을 이용해서 설계를 더 번거롭게 하는 이유는 역할을 통해 유연하고 재사용 가능한 협력을 얻을 수 있기 때문이다.

![Chapter%203%20-%20%E1%84%8B%E1%85%A7%E1%86%A8%E1%84%92%E1%85%A1%E1%86%AF,%20%E1%84%8E%E1%85%A2%E1%86%A8%E1%84%8B%E1%85%B5%E1%86%B7,%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%205aafc9eb9cef4f6cad263c6f71870891/Untitled%207.png](Chapter%203%20-%20%E1%84%8B%E1%85%A7%E1%86%A8%E1%84%92%E1%85%A1%E1%86%AF,%20%E1%84%8E%E1%85%A2%E1%86%A8%E1%84%8B%E1%85%B5%E1%86%B7,%20%E1%84%92%E1%85%A7%E1%86%B8%E1%84%85%E1%85%A7%E1%86%A8%205aafc9eb9cef4f6cad263c6f71870891/Untitled%207.png)

 할인 요금을 계산하라는 메시지를 추가적으로 생성하여 외부의 객체에게 도움을 요청할때, 영화 예매 시스템에는 AmountDiscountPolicy와 PercentDiscountPolicy가 존재한다.

 이 때, 두 종류의 객체가 참여하는 협력을 따로 만들지 않고, 두 협력을 하나로 통합한 DiscountPolicy라는 역할을 생각할 수 있다.

→ 여기서의 역할이 바로 **추상화**이다. 역할을 구현하는 가장 일반적인 방법이 **추상 클래스**와 **인터페이스**를 사용하는 것이다.

- 협력에 적합한 책임을 수행하는 대상이 한 종류라면 객체로 간주하고, 여러 종류의 객체들이 참여할 수 있다면 역할로 생각한다.

- 역할이 추상화의 개념과 부합하기 때문에, 추상화가 가지는 두 가지 장점(상위 수준의 정책을 쉽고 간단하게 표현 가능하다, 설계를 유연하게 만들 수 있다)은 역할에도 동일하게 적용된다.

(p.92 그림 3.6, 3.7, 3.8 참고) 3.6과 비교했을 때 세부 사항을 무시하고 추상화에 집중하여 표현한 3.7이 훨씬 간단해서 파악하기에 편하고, 3.8까지 보면 3.7의 객체들 사이의 협력 관계까지 명확하게 알 수 있다.

- 역할=배역/ 역할 수행하는 객체=배우/ 협력=연극/ 코드=극본

✔하나의 배역을 여러 배우가 연기할 수 있는 것처럼 동일한 역할을 수행하는 하나 이상의 객체들이 존재할 수 있으며, 이 객체들은 서로 대체 가능하다.

✔객체는 다양한 역할을 가질 수 있지만, 특정한 협력 안에서는 하나의 역할만이 보여진다.